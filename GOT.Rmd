---
title: "Network Analysis on Game of Thrones"
output: html_notebook
---

In this article, I will be exploring and doing network analysis of the families of major characters from Game of Thrones which is a very famous TV series.

If you are a big Game of thrones fan then you should know that surprisingly, __House Stark__ (specifically Ned and Sansa) and __House Lannister__ (especially Tyrion) are the most important family connections in Game of Thrones; they also connect many of the storylines and are central parts of the Series.


##What is a Network ?

A network in this context is a graph of interconnected nodes/vertices. Nodes can e.g. be people in a social network, genes in a co-expression network, etc. Nodes are connected via edges.


##What can network analysis tell us?


Network analysis can e.g. be used to explore relationships in social or professional networks. In such cases, we would typically ask questions like:

1)How many connections does each person have?

2)Who is the most connected (i.e."famous","Dominating","influential" or 
“important”) person?

3)Are there clusters of tightly connected people?

4)Are there a few key objects that connect clusters of people?
etc.

The answers can give us a lots of information and insights of lots of things and how people interact.


-----------------------



##Implementing It in R





Loading the Required Packages

```{r,warning=FALSE,message=FALSE}

require(tidyverse)
require(ggthemes)
require(igraph)
require(statnet)
```



Now loading the Game of Thrones Datasets

```{r}
#Loading the Datasets
battle<-read.csv("battles.csv")

#Deaths on characters Dataset
deaths<-read.csv("character-deaths.csv")

#pred dataset
pred<-read.csv("character-pred.csv")

```


###Data Preprocessing and Transformation


```{r}
pred[pred == ""] <- NA
#Converting Individual columns to Character data type
pred$name <- as.character(pred$name)
pred$house <- as.character(pred$house)
pred$mother <- as.character(pred$mother)
pred$father <- as.character(pred$father)
pred$spouse <- as.character(pred$spouse)


pred$house <- ifelse(is.na(pred$house) & grepl("Targaryen", pred$name), "House Targaryen", pred$house)
pred$house <- ifelse(is.na(pred$house) & grepl("Stark", pred$name), "House Stark", pred$house)

#gsub() to perform replacement and pattern matching
pred$name <- gsub("[[:punct:]]", "", pred$name)

```


####Creating a new Child_of Dataframe which will contain the Parents and the child's name.


```{r}
child_of <- data.frame(name = pred$name[grepl("son of | daughter of", pred$name)],
                     stringsAsFactors = FALSE)

child_of$child_of <- ifelse(grepl("daughter", child_of$name), paste(gsub("(.* daughter of )(.*)", "\\2", child_of$name), 
  gsub("(.* )(.*)( daughter of.*)", "\\2", child_of$name)), paste(gsub("(.* son of )(.*)", "\\2", child_of$name), 
  gsub("(.* )(.*)( son of.*)", "\\2", child_of$name)))

child_of[child_of$name == "Ulf son of Umar", "child_of"] <- "Umar"

```




Performing a Left Join between the Child_of and Pred Datasets for joining both the tables Together i.e Merging them together with a similar column.
It is similar to using *__'merge()'__* function in R

```{r}
#Joining the 2 tables by common "name" column
pred<-left_join(pred, child_of, by = "name")



#Now I am manually adding the Mother and Father names for the given  children Names
#Inside the brackets the first argument is the condition and second is the the name of the column for which you want to add value
pred[pred$name == "Arya Stark", "mother"] <- "Catelyn Stark"
pred[pred$name == "Arya Stark", "father"] <- "Eddard Stark"

pred[pred$name == "Bran Stark", "mother"] <- "Catelyn Stark"
pred[pred$name == "Bran Stark", "father"] <- "Eddard Stark"

pred[pred$name == "Sansa Stark", "mother"] <- "Catelyn Stark"
pred[pred$name == "Sansa Stark", "father"] <- "Eddard Stark"

pred[pred$name == "Rickon Stark", "mother"] <- "Catelyn Stark"
pred[pred$name == "Rickon Stark", "father"] <- "Eddard Stark"

pred[pred$name == "Jon Snow", "mother"] <- "Lyanna Stark"
pred[pred$name == "Jon Snow", "father"] <- "Eddard Stark"
pred[pred$name == "Jon Snow", "child_of"] <- "Rhaegar Targaryen"

pred[pred$name == "Theon Greyjoy", "mother"] <- "Alannys Harlaw"
pred[pred$name == "Theon Greyjoy", "father"] <- "Balon Greyjoy"

pred[pred$name == "Asha Greyjoy", "mother"] <- "Alannys Harlaw"
pred[pred$name == "Asha Greyjoy", "father"] <- "Balon Greyjoy"

pred[pred$name == "Tommen Baratheon", "house"] <- "House Baratheon/Lannister"
pred[pred$name == "Balon Greyjoy", "house"] <- "House Greyjoy"

pred[pred$name == "Balon Greyjoy", "mother"] <- "Lady of House Sunderly"

pred[pred$name == "Victarion Greyjoy", "mother"] <- "Lady of House Sunderly"
pred[pred$name == "Victarion Greyjoy", "father"] <- "Quellon Greyjoy"

pred[pred$name == "Ramsay Snow", "father"] <- "Roose Bolton"

pred[pred$name == "Myrcella Baratheon", "mother"] <- "Cersei Lannister"
pred[pred$name == "Myrcella Baratheon", "father"] <- "Robert Baratheon"

pred[pred$name == "Shireen Baratheon", "mother"] <- "Selyse Florent"
pred[pred$name == "Shireen Baratheon", "father"] <- "Stannis Baratheon"

pred[pred$name == "Renly Baratheon", "mother"] <- "Cassana Baratheon"
pred[pred$name == "Renly Baratheon", "father"] <- "Steffon Baratheon"

pred[pred$name == "Stannis Baratheon", "mother"] <- "Cassana Baratheon"

#adding a row to the Pred dataset
add <- pred[1, ] #Adding a row
add[1, ] <- NA
add$name <- "Robert Baratheon"
add$mother <- "Cassana Baratheon"
add$father <- "Steffon Baratheon"
add$spouse <- "Cersei Lannister"
pred <- rbind(pred, add) #Binding Row wise to the dataset
 
#----------
  
#Adding some more values

pred[pred$name == "Catelyn Stark", "mother"] <- "Minisa Whent"
pred[pred$name == "Catelyn Stark", "father"] <- "Hoster Tully"

pred[pred$name == "Edmure Tully", "mother"] <- "Minisa Whent"
pred[pred$name == "Edmure Tully", "father"] <- "Hoster Tully"

pred[pred$name == "Lysa Arryn", "mother"] <- "Minisa Whent"
pred[pred$name == "Lysa Arryn", "father"] <- "Hoster Tully"

pred[pred$name == "Robert Arryn", "mother"] <- "Lysa Arryn"
pred[pred$name == "Robert Arryn", "father"] <- "Jon Arryn"

pred[pred$name == "Lyanna Stark", "father"] <- "Rickard Stark"
pred[pred$name == "Eddard Stark", "father"] <- "Rickard Stark"
pred[pred$name == "Brandon Stark", "father"] <- "Rickard Stark"
pred[pred$name == "Benjen Stark", "father"] <- "Rickard Stark"

pred[pred$name == "Rickard Stark", "mother"] <- "Marna Locke"
pred[pred$name == "Rickard Stark", "father"] <- "Edwyle Stark"

pred[pred$name == "Willam Stark", "mother"] <- "Lorra Royce"
pred[pred$name == "Willam Stark", "father"] <- "Beron Stark"

pred[pred$name == "Rodrik Stark son of Beron", "mother"] <- "Lorra Royce"
pred[pred$name == "Rodrik Stark son of Beron", "father"] <- "Beron Stark"
pred[pred$name == "Rodrik Stark son of Beron", "child_of"] <- NA

add <- pred[1, ]
add[1, ] <- NA
add$name <- "Lyarra Stark"
add$mother <- "Arya Flint"
add$father <- "Rodrik Stark"
add$spouse <- "Rickard Stark"
pred <- rbind(pred, add)


#------------
  

#Adding some more Names

pred[pred$name == "Artos Stark", "mother"] <- "Lorra Royce"
pred[pred$name == "Artos Stark", "father"] <- "Beron Stark"

pred[pred$name == "Rodwell Stark", "mother"] <- "Alys Karstark"
pred[pred$name == "Rodwell Stark", "father"] <- "Brandon Stark son of Cregan"

pred[pred$name == "Beron Stark", "mother"] <- "Alys Karstark"
pred[pred$name == "Beron Stark", "father"] <- "Brandon Stark son of Cregan"

pred[pred$name == "Brandon Stark son of Cregan", "mother"] <- "Lynara Stark"
pred[pred$name == "Brandon Stark son of Cregan", "father"] <- "Cregan Stark"

pred[pred$name == "Cregan Stark", "mother"] <- "Gilliane Glover"
pred[pred$name == "Cregan Stark", "father"] <- "Rickon Stark son of Benjen"

pred[pred$name == "Cersei Lannister", "mother"] <- "Joanna Lannister"
pred[pred$name == "Cersei Lannister", "father"] <- "Tywin Lannister"

pred[pred$name == "Jaime Lannister", "mother"] <- "Joanna Lannister"
pred[pred$name == "Jaime Lannister", "father"] <- "Tywin Lannister"

pred[pred$name == "Tyrion Lannister", "mother"] <- "Joanna Lannister"
pred[pred$name == "Tyrion Lannister", "father"] <- "Tywin Lannister"

pred[pred$name == "Joffrey Baratheon", "child_of"] <- "Jaime Lannister"
pred[pred$name == "Myrcella Baratheon", "child_of"] <- "Jaime Lannister"
pred[pred$name == "Tommen Baratheon", "child_of"] <- "Jaime Lannister"

pred[pred$name == "Jonnel Stark", "father"] <- "Cregan Stark"
pred[pred$name == "Jonnel Stark", "mother"] <- "Lynara Stark"

pred[pred$name == "Brendan Stark son of Cregan", "father"] <- "Cregan Stark"
pred[pred$name == "Brendan Stark son of Cregan", "child_of"] <- NA

pred[pred$name == "Eddard Stark", "mother"] <- "Lyarra Stark"
pred[pred$name == "Benjen Stark", "mother"] <- "Lyarra Stark"
pred[pred$name == "Brandon Stark", "mother"] <- "Lyarra Stark"
pred[pred$name == "Lyanna Stark", "mother"] <- "Lyarra Stark"

pred[pred$name == "Edwyle Stark", "mother"] <- "Melantha Blackwood"
pred[pred$name == "Edwyle Stark", "father"] <- "Willam Stark"

pred[pred$name == "Cerenna Lannister", "mother"] <- "Myranda Lefford"
pred[pred$name == "Myrielle Lannister", "mother"] <- "Myranda Lefford"
pred[pred$name == "Daven Lannister", "mother"] <- "Myranda Lefford"

pred[pred$name == "Cerenna Lannister", "father"] <- "Stafford Lannister"
pred[pred$name == "Myrielle Lannister", "father"] <- "Stafford Lannister"
pred[pred$name == "Daven Lannister", "father"] <- "Stafford Lannister"

pred[pred$name == "Joanna Lannister", "father"] <- "Jason Lannister"
pred[pred$name == "Joanna Lannister", "mother"] <- "Marla Prester"

pred[pred$name == "Stafford Lannister", "father"] <- "Jason Lannister"
pred[pred$name == "Stafford Lannister", "mother"] <- "Marla Prester"

pred[pred$name == "Tywin Lannister", "father"] <- "Tytos Lannister"
pred[pred$name == "Kevan Lannister", "father"] <- "Tytos Lannister"
pred[pred$name == "Genna Lannister", "father"] <- "Tytos Lannister"

pred[pred$name == "Lancel Lannister", "father"] <- "Kevan Lannister"
pred[pred$name == "Lancel Lannister", "mother"] <- "Dorna Swyft"

pred[pred$name == "Willem Lannister", "father"] <- "Kevan Lannister"
pred[pred$name == "Willem Lannister", "mother"] <- "Dorna Swyft"

pred[pred$name == "Brandon Stark son of Cregan", "child_of"] <- NA

pred[pred$name == "Lanna Lannister", "father"] <- "Damion Lannister"
pred[pred$name == "Lanna Lannister", "mother"] <- "Shiera Crakehall"

pred[pred$name == "Lucion Lannister", "father"] <- "Damion Lannister"
pred[pred$name == "Lucion Lannister", "mother"] <- "Shiera Crakehall"

pred[pred$name == "Damion Lannister", "father"] <- "Damon Lannister son of Jason"
pred[pred$name == "Damion Lannister", "mother"] <- "Ella Lannister"

pred[pred$name == "Damon Lannister son of Jason", "father"] <- "Jason Lannister"
pred[pred$name == "Damon Lannister son of Jason", "child_of"] <- NA
pred[pred$name == "Damon Lannister son of Jason", "mother"] <- "Alys Stackspear"

pred[pred$name == "Jason Lannister", "father"] <- "Gerold Lannister"
pred[pred$name == "Jason Lannister", "mother"] <- "Rohanne Webber"

pred[pred$name == "Damon Lannister lord", "name"] <- "Damon Lannister"
pred[pred$name == "Tybolt Lannister", "father"] <- "Damon Lannister"
pred[pred$name == "Tybolt Lannister", "mother"] <- "Cerissa Brax"

pred[pred$name == "Gerold Lannister", "father"] <- "Damon Lannister"
pred[pred$name == "Gerold Lannister", "mother"] <- "Cerissa Brax"

pred[pred$name == "Tygett Lannister", "father"] <- "Tytos Lannister"
pred[pred$name == "Tygett Lannister", "mother"] <- "Jeyne Marbrand"
pred[pred$name == "Tywin Lannister", "mother"] <- "Jeyne Marbrand"
pred[pred$name == "Kevan Lannister", "mother"] <- "Jeyne Marbrand"
pred[pred$name == "Genna Lannister", "mother"] <- "Jeyne Marbrand"

pred[pred$name == "Gerion Lannister", "father"] <- "Tytos Lannister"
pred[pred$name == "Gerion Lannister", "mother"] <- "Jeyne Marbrand"

pred[pred$name == "Tyrek Lannister", "father"] <- "Tygett Lannister"
pred[pred$name == "Tyrek Lannister", "mother"] <- "Darlessa Marbrand"

pred[pred$name == "Steffon Baratheon", "father"] <- "Ormund Baratheon"
pred[pred$name == "Steffon Baratheon", "mother"] <- "Rhaelle Targaryen"

pred[pred$name == "Daenerys Targaryen", "father"] <- "Aerys II Targaryen"
pred[pred$name == "Daenerys Targaryen", "mother"] <- "Rhaella Targaryen"

pred[pred$name == "Viserys Targaryen", "father"] <- "Aerys II Targaryen"
pred[pred$name == "Viserys Targaryen", "mother"] <- "Rhaella Targaryen"

pred[pred$name == "Rhaegar Targaryen", "father"] <- "Aerys II Targaryen"
pred[pred$name == "Rhaegar Targaryen", "mother"] <- "Rhaella Targaryen"

pred[pred$name == "Rhaella Targaryen", "father"] <- "Jaehaerys II Targaryen"
pred[pred$name == "Rhaella Targaryen", "mother"] <- "Shaera Targaryen"

pred[pred$name == "Rhaenys Targaryen daughter of Rhaegar", "father"] <- "Rhaegar Targaryen"
pred[pred$name == "Rhaenys Targaryen daughter of Rhaegar", "mother"] <- "Elia Martell"
pred[pred$name == "Rhaenys Targaryen daughter of Rhaegar", "child_of"] <- NA

pred[pred$name == "Aegon Targaryen daughter of Rhaegar", "father"] <- "Rhaegar Targaryen"
pred[pred$name == "Aegon Targaryen daughter of Rhaegar", "mother"] <- "Elia Martell"
pred[pred$name == "Aegon Targaryen daughter of Rhaegar", "child_of"] <- NA

pred[pred$name == "Aegon IV Targaryen", "father"] <- "Aerys II Targaryen"
pred[pred$name == "Aegon IV Targaryen", "mother"] <- "Rhaella Targaryen"

add <- pred[pred$name == "Jaehaerys II Targaryen", ]
add[, "name"] <- "Shaera Targaryen"
pred <- rbind(pred, add)



```


